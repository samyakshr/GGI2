<!--
=========================================================
* Material Dashboard 3 - v3.2.0
=========================================================

* Product Page: https://www.creative-tim.com/product/material-dashboard
* Copyright 2024 Creative Tim (https://www.creative-tim.com)
* Licensed under MIT (https://www.creative-tim.com/license)
* Coded by Creative Tim

=========================================================

* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
  <link rel="icon" type="image/png" href="../assets/img/favicon.png">
  <title>
    GGI
  </title>
  <!--     Fonts and icons     -->
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Inter:300,400,500,600,700,900" />
  <!-- Nucleo Icons -->
  <link href="../assets/css/nucleo-icons.css" rel="stylesheet" />
  <link href="../assets/css/nucleo-svg.css" rel="stylesheet" />
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <!-- Material Icons -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
  <!-- CSS Files -->
  <link id="pagestyle" href="../assets/css/material-dashboard.css?v=3.2.0" rel="stylesheet" />
</head>

<body class="g-sidenav-show  bg-gray-100">
  <aside class="sidenav navbar navbar-vertical navbar-expand-xs border-radius-lg fixed-start ms-2  bg-white my-2" id="sidenav-main">
    <div class="sidenav-header">
      <i class="fas fa-times p-3 cursor-pointer text-dark opacity-5 position-absolute end-0 top-0 d-none d-xl-none" aria-hidden="true" id="iconSidenav"></i>
      <a class="navbar-brand px-4 py-3 m-0" href="https://www.thegund.org/" target="_blank">
        <img src="../assets/img/gundgal.jpg" class="navbar-brand-img" width="26" height="26" alt="gund_logo">
        <span class="ms-1 text-sm text-dark">The Gund</span>
      </a>
    </div>
    <hr class="horizontal dark mt-0 mb-2">
    <div class="collapse navbar-collapse  w-auto " id="sidenav-collapse-main">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link active bg-gradient-dark text-white" href="../pages/dashboard.html">
            <i class="material-symbols-rounded opacity-5">dashboard</i>
            <span class="nav-link-text ms-1">Dashboard</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-dark" href="../pages/artists.html">
            <i class="material-symbols-rounded opacity-5">table_view</i>
            <span class="nav-link-text ms-1">Artists</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-dark" href="../pages/display.html">
            <i class="material-symbols-rounded opacity-5">tv</i>
            <span class="nav-link-text ms-1">Display</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-dark" href="../pages/virtual-reality.html">
            <i class="material-symbols-rounded opacity-5">view_in_ar</i>
            <span class="nav-link-text ms-1">Virtual Reality</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-dark" href="../pages/notifications.html">
            <i class="material-symbols-rounded opacity-5">notifications</i>
            <span class="nav-link-text ms-1">Notifications</span>
          </a>
        </li>
        <li class="nav-item mt-3">
          <h6 class="ps-4 ms-2 text-uppercase text-xs text-dark font-weight-bolder opacity-5">Account pages</h6>
        </li>
        <li class="nav-item">
          <a class="nav-link text-dark" href="../pages/profile.html">
            <i class="material-symbols-rounded opacity-5">person</i>
            <span class="nav-link-text ms-1">Profile</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-dark" href="../pages/sign-in.html">
            <i class="material-symbols-rounded opacity-5">login</i>
            <span class="nav-link-text ms-1">Sign In</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-dark" href="../pages/sign-up.html">
            <i class="material-symbols-rounded opacity-5">assignment</i>
            <span class="nav-link-text ms-1">Sign Up</span>
          </a>
        </li>
      </ul>
    </div>
    <div class="sidenav-footer position-absolute w-100 bottom-0 ">
      <div class="mx-3">
        <a class="btn btn-outline-dark mt-4 w-100" href="https://www.creative-tim.com/learning-lab/bootstrap/overview/material-dashboard?ref=sidebarfree" type="button">Documentation</a>
        <a class="btn bg-gradient-dark w-100" href="https://www.creative-tim.com/product/material-dashboard-pro?ref=sidebarfree" type="button">Upgrade to pro</a>
      </div>
    </div>
  </aside>
  <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg">
    <!-- Navbar -->
    <nav class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl" id="navbarBlur" navbar-scroll="true">
      <div class="container-fluid py-1 px-3">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0 me-sm-6 me-5">
            <li class="breadcrumb-item text-sm"><a class="opacity-5 text-dark" href="javascript:;">Pages</a></li>
            <li class="breadcrumb-item text-sm text-dark active" aria-current="page">Dashboard</li>
          </ol>
          <h6 class="font-weight-bolder mb-0">Dashboard</h6>
        </nav>
        <div class="collapse navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4" id="navbar">
          <div class="ms-md-auto pe-md-3 d-flex align-items-center">
            <div class="input-group input-group-outline">
              <label class="form-label">Type here...</label>
              <input type="text" class="form-control">
            </div>
          </div>
          <ul class="navbar-nav justify-content-end">
            <li class="nav-item d-flex align-items-center">
              <a href="javascript:;" class="nav-link text-body font-weight-bold px-0">
                <i class="fa fa-user me-sm-1"></i>
                <span class="d-sm-inline d-none">Sign In</span>
              </a>
            </li>
            <li class="nav-item d-xl-none ps-3 d-flex align-items-center">
              <a href="javascript:;" class="nav-link text-body p-0" id="iconNavbarSidenav">
                <div class="sidenav-toggler-inner">
                  <i class="sidenav-toggler-line"></i>
                  <i class="sidenav-toggler-line"></i>
                  <i class="sidenav-toggler-line"></i>
                    </div>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- End Navbar -->
    <div class="container-fluid py-4">
      <div class="row">
        <div class="col-lg-8">
      <div class="row">
            <div class="col-xl-12 mb-xl-0 mb-4">
              <div class="card bg-transparent shadow-xl">
                <div class="card-body p-3">
                <div class="chart">
                    <canvas id="artwork-chart" class="chart-canvas" height="300"></canvas>
                </div>
              </div>
              </div>
            </div>
            <div class="col-xl-12 mb-xl-0 mb-4">
              <div class="card bg-transparent shadow-xl">
                <div class="card-body p-3">
                <div class="chart">
                    <canvas id="emotion-chart" class="chart-canvas" height="300"></canvas>
                </div>
              </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-4">
          <div class="card h-100">
            <div class="card-header pb-0 p-3">
              <div class="row">
                <div class="col-6 d-flex align-items-center">
                  <h6 class="mb-0">Recent Responses</h6>
                </div>
                <div class="col-6 text-end">
                  <button class="btn btn-outline-primary btn-sm mb-0" onclick="showAllResponses()">View All</button>
                </div>
              </div>
            </div>
            <div class="card-body p-3 pb-0">
              <ul class="list-group" id="recent-responses">
                <!-- Recent responses will be added here dynamically -->
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row mt-4">
      <div class="col-12">
        <div class="card">
          <div class="card-header p-3">
            <h5 class="mb-0">Monthly Response Frequency</h5>
          </div>
          <div class="card-body p-3">
            <div class="chart">
              <canvas id="weekly-entries-chart" class="chart-canvas" height="300"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row mt-4">
      <div class="col-lg-6 mb-lg-0 mb-4">
        <div class="card">
          <div class="card-header p-3">
            <h5 class="mb-0">Emotion Distribution Over Time</h5>
          </div>
          <div class="card-body p-3">
            <div class="chart">
              <canvas id="emotion-time-chart" class="chart-canvas" height="300"></canvas>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-6 mb-lg-0 mb-4">
        <div class="card">
          <div class="card-header p-3">
            <h5 class="mb-0">Artwork Popularity by Emotion</h5>
          </div>
          <div class="card-body p-3">
            <div class="chart">
              <canvas id="artwork-emotion-chart" class="chart-canvas" height="300"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row mt-4">
      <div class="col-lg-6 mb-lg-0 mb-4">
        <div class="card">
          <div class="card-header p-3">
            <h5 class="mb-0">Response Time Analysis</h5>
          </div>
          <div class="card-body p-3">
            <div class="chart">
              <canvas id="time-heatmap" class="chart-canvas" height="300"></canvas>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-6 mb-lg-0 mb-4">
        <div class="card">
          <div class="card-header p-3">
            <h5 class="mb-0">Engagement Score</h5>
          </div>
          <div class="card-body p-3">
            <div class="chart">
              <canvas id="engagement-gauge" class="chart-canvas" height="300"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
  
  <!-- Add Modal for All Responses -->
  <div class="modal fade" id="allResponsesModal" tabindex="-1" role="dialog" aria-labelledby="allResponsesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="allResponsesModalLabel">All Responses</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="table-responsive">
            <table class="table align-items-center mb-0">
              <thead>
                <tr>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Timestamp</th>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Experience</th>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Artwork</th>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Emotion</th>
                </tr>
              </thead>
              <tbody id="allResponsesTable">
                <!-- Responses will be dynamically added here -->
              </tbody>
            </table>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <div class="fixed-plugin">
    <a class="fixed-plugin-button text-dark position-fixed px-3 py-2">
      <i class="material-symbols-rounded py-2">settings</i>
    </a>
    <div class="card shadow-lg">
      <div class="card-header pb-0 pt-3">
        <div class="float-start">
          <h5 class="mt-3 mb-0">Material UI Configurator</h5>
          <p>See our dashboard options.</p>
        </div>
        <div class="float-end mt-4">
          <button class="btn btn-link text-dark p-0 fixed-plugin-close-button">
            <i class="material-symbols-rounded">clear</i>
          </button>
        </div>
        <!-- End Toggle Button -->
      </div>
      <hr class="horizontal dark my-1">
      <div class="card-body pt-sm-3 pt-0">
        <!-- Sidebar Backgrounds -->
        <div>
          <h6 class="mb-0">Sidebar Colors</h6>
        </div>
        <a href="javascript:void(0)" class="switch-trigger background-color">
          <div class="badge-colors my-2 text-start">
            <span class="badge filter bg-gradient-primary" data-color="primary" onclick="sidebarColor(this)"></span>
            <span class="badge filter bg-gradient-dark active" data-color="dark" onclick="sidebarColor(this)"></span>
            <span class="badge filter bg-gradient-info" data-color="info" onclick="sidebarColor(this)"></span>
            <span class="badge filter bg-gradient-success" data-color="success" onclick="sidebarColor(this)"></span>
            <span class="badge filter bg-gradient-warning" data-color="warning" onclick="sidebarColor(this)"></span>
            <span class="badge filter bg-gradient-danger" data-color="danger" onclick="sidebarColor(this)"></span>
          </div>
        </a>
        <!-- Sidenav Type -->
        <div class="mt-3">
          <h6 class="mb-0">Sidenav Type</h6>
          <p class="text-sm">Choose between different sidenav types.</p>
        </div>
        <div class="d-flex">
          <button class="btn bg-gradient-dark px-3 mb-2" data-class="bg-gradient-dark" onclick="sidebarType(this)">Dark</button>
          <button class="btn bg-gradient-dark px-3 mb-2 ms-2" data-class="bg-transparent" onclick="sidebarType(this)">Transparent</button>
          <button class="btn bg-gradient-dark px-3 mb-2  active ms-2" data-class="bg-white" onclick="sidebarType(this)">White</button>
        </div>
        <p class="text-sm d-xl-none d-block mt-2">You can change the sidenav type just on desktop view.</p>
        <!-- Navbar Fixed -->
        <div class="mt-3 d-flex">
          <h6 class="mb-0">Navbar Fixed</h6>
          <div class="form-check form-switch ps-0 ms-auto my-auto">
            <input class="form-check-input mt-1 ms-auto" type="checkbox" id="navbarFixed" onclick="navbarFixed(this)">
          </div>
        </div>
        <hr class="horizontal dark my-3">
        <div class="mt-2 d-flex">
          <h6 class="mb-0">Light / Dark</h6>
          <div class="form-check form-switch ps-0 ms-auto my-auto">
            <input class="form-check-input mt-1 ms-auto" type="checkbox" id="dark-version" onclick="darkMode(this)">
          </div>
        </div>
        <hr class="horizontal dark my-sm-4">
        <a class="btn bg-gradient-info w-100" href="https://www.creative-tim.com/product/material-dashboard-pro">Free Download</a>
        <a class="btn btn-outline-dark w-100" href="https://www.creative-tim.com/learning-lab/bootstrap/overview/material-dashboard">View documentation</a>
        <div class="w-100 text-center">
          <a class="github-button" href="https://github.com/creativetimofficial/material-dashboard" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star creativetimofficial/material-dashboard on GitHub">Star</a>
          <h6 class="mt-3">Thank you for sharing!</h6>
          <a href="https://twitter.com/intent/tweet?text=Check%20Material%20UI%20Dashboard%20made%20by%20%40CreativeTim%20%23webdesign%20%23dashboard%20%23bootstrap5&amp;url=https%3A%2F%2Fwww.creative-tim.com%2Fproduct%2Fsoft-ui-dashboard" class="btn btn-dark mb-0 me-2" target="_blank">
            <i class="fab fa-twitter me-1" aria-hidden="true"></i> Tweet
          </a>
          <a href="https://www.facebook.com/sharer/sharer.php?u=https://www.creative-tim.com/product/material-dashboard" class="btn btn-dark mb-0 me-2" target="_blank">
            <i class="fab fa-facebook-square me-1" aria-hidden="true"></i> Share
          </a>
        </div>
      </div>
    </div>
  </div>
  <!--   Core JS Files   -->
  <script src="../assets/js/core/popper.min.js"></script>
  <script src="../assets/js/core/bootstrap.min.js"></script>
  <script src="../assets/js/plugins/perfect-scrollbar.min.js"></script>
  <script src="../assets/js/plugins/smooth-scrollbar.min.js"></script>
  <script src="../assets/js/plugins/chartjs.min.js"></script>
  <!-- Add Chart.js plugins -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-matrix@1.2.0/dist/chartjs-chart-matrix.min.js"></script>
  <script>
    // Store chart instances and responses
    let artworkChart = null;
    let emotionChart = null;
    let emotionTimeChart = null;
    let artworkEmotionChart = null;
    let timeHeatmap = null;
    let engagementGauge = null;
    let allResponses = [];
    let responseModal = null;

    // Initialize when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM loaded, initializing components...');
      // Initialize the modal
      const modalElement = document.getElementById('allResponsesModal');
      if (modalElement) {
        responseModal = new bootstrap.Modal(modalElement);
        console.log('Modal initialized');
      } else {
        console.error('Modal element not found');
      }
      
      // Initial update
      updateCharts();
      
      // Update every 30 seconds
      setInterval(updateCharts, 30000);
    });

    // Function to show all responses in modal
    async function showAllResponses() {
      try {
        console.log('Showing all responses...');
        if (!responseModal) {
          const modalElement = document.getElementById('allResponsesModal');
          if (!modalElement) {
            console.error('Modal element not found');
            return;
          }
          responseModal = new bootstrap.Modal(modalElement);
        }

        const tableBody = document.getElementById('allResponsesTable');
        if (!tableBody) {
          console.error('Table body element not found');
          return;
        }

        // Clear existing table content
        tableBody.innerHTML = '';

        // If we don't have the data yet, fetch it
        if (allResponses.length === 0) {
          console.log('Fetching all responses...');
          const data = await fetchData();
          if (data && Array.isArray(data.recentResponses)) {
            allResponses = data.recentResponses;
          }
        }

        console.log('Processing responses:', allResponses);

        // Sort responses by timestamp (most recent first)
        allResponses.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

        // Add each response to the table
        allResponses.forEach(response => {
          const row = document.createElement('tr');
          
          // Format the timestamp
          const date = new Date(response.timestamp);
          const formattedDate = date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
          
          // Get emotion color
          const emotionColors = {
            'happy': 'text-success',
            'sad': 'text-danger',
            'nostalgic': 'text-info',
            'bored': 'text-warning'
          };
          const emotionColor = emotionColors[response.emotion] || 'text-dark';
          
          row.innerHTML = `
            <td>
              <div class="d-flex px-2 py-1">
                <div class="d-flex flex-column justify-content-center">
                  <h6 class="mb-0 text-sm">${formattedDate}</h6>
                </div>
              </div>
            </td>
            <td>
              <div class="d-flex px-2 py-1">
                <div class="d-flex flex-column justify-content-center">
                  <p class="text-xs text-secondary mb-0">${response.experience}</p>
                </div>
              </div>
            </td>
            <td>
              <div class="d-flex px-2 py-1">
                <div class="d-flex flex-column justify-content-center">
                  <h6 class="mb-0 text-sm">${response.artwork}</h6>
                </div>
              </div>
            </td>
            <td>
              <div class="d-flex px-2 py-1">
                <div class="d-flex flex-column justify-content-center">
                  <span class="badge badge-sm bg-gradient-${emotionColor}">${response.emotion}</span>
                </div>
              </div>
            </td>
          `;
          
          tableBody.appendChild(row);
        });

        // Show the modal
        console.log('Showing modal');
        responseModal.show();

      } catch (error) {
        console.error('Error showing all responses:', error);
      }
    }

    // Function to fetch data from Google Sheets
    async function fetchData() {
      try {
        console.log('Fetching data from Google Sheets...');
        const spreadsheetId = '1HbaoSO3-QHKhYUHy4DuerkH_Z2kV9eoPQOOhTkTWwhQ';
        const apiKey = 'AIzaSyCOmA67laPyNblmRifkKckoYCZKo8FmyfU';
        const range = 'Form Responses 1!A:D';
        
        const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=${apiKey}`;
        
        const response = await fetch(url, {
          method: 'GET',
          headers: {
            'Accept': 'application/json'
          }
        });
        
        if (!response.ok) {
          throw new Error(`API request failed: ${response.status} ${response.statusText}`);
        }
        
        const data = await response.json();
        if (!data.values || data.values.length === 0) {
          throw new Error('No data found in sheet');
        }
        
        const processedData = await processSheetData(data.values);
        
        // Process monthly data instead of weekly
        const monthlyData = processMonthlyData(processedData.recentResponses);
        updateMonthlyChart(monthlyData);
        
        return processedData;
      } catch (error) {
        console.error('Error fetching data:', error);
        return getSampleData();
      }
    }

    // Function to classify emotion from text
    async function classifyEmotion(text) {
      if (!text) return 'unknown';
      try {
        const response = await fetch('/.netlify/functions/classify-emotion', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text })
        });
        const data = await response.json();
        return data.emotion;
      } catch (e) {
        console.error('Emotion classification failed:', e);
        return 'unknown';
      }
    }

    // Function to process sheet data
    async function processSheetData(values) {
      if (!values || values.length === 0) {
        throw new Error('No data found in the sheet');
      }
      const headers = values[0];
      const experienceColIndex = 1;
      const artworkColIndex = 2;
      const timestampColIndex = 0;
      allResponses = [];
      const artworkVotes = {
        'Measuring the Universe': 0,
        'Think Far': 0,
        'From Wind to Rivers to the Abyssal Plain': 0,
        'Eleven Columns': 0
      };
      const emotionCounts = {
        'happy': 0,
        'sad': 0,
        'nostalgic': 0,
        'bored': 0
      };
      for (let i = 1; i < values.length; i++) {
        const row = values[i];
        const experience = row[experienceColIndex]?.trim() || '';
        const artwork = row[artworkColIndex]?.trim() || '';
        if (artwork && artworkVotes.hasOwnProperty(artwork)) {
          artworkVotes[artwork]++;
          console.log(`Counted vote for artwork: ${artwork}`);
        }
        const emotion = await classifyEmotion(experience);
        console.log(`Row ${i} - Experience: "${experience}" classified as: ${emotion}`);
        if (emotionCounts.hasOwnProperty(emotion)) {
          emotionCounts[emotion]++;
        }
        allResponses.push({
          experience: experience,
          artwork: artwork || 'Unknown',
          emotion: emotion,
          timestamp: row[timestampColIndex]
        });
      }
      console.log('Final artwork votes:', artworkVotes);
      console.log('Final emotion counts:', emotionCounts);
      allResponses.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      const recent10 = allResponses.slice(0, 10);
      return {
        artworkVotes,
        emotionCounts,
        recentResponses: recent10,
        dailyStats: {
          totalResponses: values.length - 1,
          engagementRate: Math.round(((emotionCounts.happy + emotionCounts.nostalgic) / (values.length - 1)) * 100)
        }
      };
    }

    function getSampleData() {
      return {
        artworkVotes: {
          'Measuring the Universe': 0,
          'Think Far': 1,
          'From Wind to Rivers to the Abyssal Plain': 1,
          'Eleven Columns': 1
        },
        emotionCounts: {
          'happy': 1,
          'sad': 1,
          'nostalgic': 1,
          'bored': 0
        },
        recentResponses: [
          {
            experience: "Made me so happy!",
            artwork: "Think Far",
            emotion: "happy",
            timestamp: "4/15/2025 13:17:52"
          },
          {
            experience: "Dissappointing",
            artwork: "From Wind to Rivers to the Abyssal Plain",
            emotion: "sad",
            timestamp: "4/15/2025 13:18:04"
          },
          {
            experience: "Reminded me of my grandmother",
            artwork: "Eleven Columns",
            emotion: "nostalgic",
            timestamp: "4/15/2025 13:18:17"
          }
        ],
        dailyStats: {
          totalResponses: 3,
          engagementRate: 75
        }
      };
    }

    // Function to update daily statistics
    function updateDailyStats(dailyStats) {
      console.log('Updating daily stats with:', dailyStats);
      const totalResponsesElement = document.getElementById('total-responses');
      const engagementRateElement = document.getElementById('engagement-rate');
      
      if (totalResponsesElement) {
        totalResponsesElement.textContent = dailyStats.totalResponses || 0;
      }
      
      if (engagementRateElement) {
        engagementRateElement.textContent = `${dailyStats.engagementRate || 0}%`;
      }
    }

    // Function to process time-based emotion data
    function processTimeEmotionData(responses) {
      const timeSlots = Array.from({length: 24}, (_, i) => i);
      const emotions = ['happy', 'sad', 'nostalgic', 'bored'];
      const data = {};
      
      emotions.forEach(emotion => {
        data[emotion] = timeSlots.map(hour => {
          return responses.filter(r => {
            const responseHour = new Date(r.timestamp).getHours();
            return responseHour === hour && r.emotion === emotion;
          }).length;
        });
      });
      
      return data;
    }

    // Function to process artwork-emotion data
    function processArtworkEmotionData(responses) {
      console.log('Processing artwork-emotion data from responses:', responses);
      
      const data = {};
      const emotions = ['happy', 'sad', 'nostalgic', 'bored'];
      
      // Initialize data structure for each emotion
      emotions.forEach(emotion => {
        data[emotion] = {
          'Measuring the Universe': 0,
          'Think Far': 0,
          'From Wind to Rivers to the Abyssal Plain': 0,
          'Eleven Columns': 0
        };
      });
      
      // Count responses for each artwork-emotion combination
      responses.forEach(response => {
        if (response.artwork && response.emotion) {
          data[response.emotion][response.artwork]++;
        }
      });
      
      console.log('Processed artwork-emotion data:', data);
      return data;
    }

    // Function to update emotion time chart
    function updateEmotionTimeChart(data) {
      const ctx = document.getElementById('emotion-time-chart');
      if (!ctx) return;
      
      if (emotionTimeChart) {
        emotionTimeChart.destroy();
      }
      
      const colors = {
        happy: '#4CAF50',
        sad: '#F44336',
        nostalgic: '#2196F3',
        bored: '#FFC107'
      };
      
      emotionTimeChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: Array.from({length: 24}, (_, i) => `${i}:00`),
          datasets: Object.entries(data).map(([emotion, values]) => ({
            label: emotion.charAt(0).toUpperCase() + emotion.slice(1),
            data: values,
            borderColor: colors[emotion],
            backgroundColor: `${colors[emotion]}20`,
            tension: 0.4,
            fill: true
          }))
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                stepSize: 1
              }
            }
          }
        }
      });
    }

    // Function to update artwork-emotion chart
    function updateArtworkEmotionChart(data) {
      const ctx = document.getElementById('artwork-emotion-chart');
      if (!ctx) return;
      
      if (artworkEmotionChart) {
        artworkEmotionChart.destroy();
      }
      
      const emotions = Object.keys(data);
      const artworks = Object.keys(data[emotions[0]]);
      const colors = {
        'Tree': '#4CAF50',    // Green
        'Flower': '#F44336',  // Red
        'Swing': '#2196F3',   // Blue
        'House': '#FFC107'    // Yellow
      };
      
      artworkEmotionChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: emotions.map(e => e.charAt(0).toUpperCase() + e.slice(1)),
          datasets: artworks.map(artwork => ({
            label: artwork,
            data: emotions.map(emotion => data[emotion][artwork]),
            backgroundColor: colors[artwork],
            borderColor: colors[artwork],
            borderWidth: 1
          }))
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
            },
            title: {
              display: true,
              text: 'Artwork Popularity by Emotion'
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                stepSize: 1
              },
              title: {
                display: true,
                text: 'Number of Responses'
              }
            },
            x: {
              title: {
                display: true,
                text: 'Emotions'
              }
            }
          }
        }
      });
    }

    // Function to update time heatmap
    function updateTimeHeatmap(responses) {
      const ctx = document.getElementById('time-heatmap');
      if (!ctx) return;
      
      if (timeHeatmap) {
        timeHeatmap.destroy();
      }
      
      const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      const hours = Array.from({length: 24}, (_, i) => `${i}:00`);
      
      // Create a 2D array filled with zeros
      const data = Array(7).fill().map(() => Array(24).fill(0));
      
      // Fill the data array with response counts
      responses.forEach(response => {
        const date = new Date(response.timestamp);
        const day = date.getDay();
        const hour = date.getHours();
        data[day][hour]++;
      });
      
      // Convert 2D array to the format expected by the matrix chart
      const chartData = [];
      for (let i = 0; i < 7; i++) {
        for (let j = 0; j < 24; j++) {
          chartData.push({
            x: j,
            y: i,
            v: data[i][j]
          });
        }
      }
      
      timeHeatmap = new Chart(ctx, {
        type: 'matrix',
        data: {
          datasets: [{
            data: chartData,
            backgroundColor(context) {
              const value = context.dataset.data[context.dataIndex].v;
              const maxValue = Math.max(...chartData.map(d => d.v));
              const alpha = maxValue > 0 ? value / maxValue : 0;
              return `rgba(76, 175, 80, ${alpha})`;
            },
            borderWidth: 1,
            borderColor: '#ffffff',
            width: ({chart}) => (chart.chartArea || {}).width / 24 - 1,
            height: ({chart}) => (chart.chartArea || {}).height / 7 - 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              callbacks: {
                title(context) {
                  const point = context[0].raw;
                  return `${days[point.y]}, ${hours[point.x]}`;
                },
                label(context) {
                  return `Responses: ${context.raw.v}`;
                }
              }
            }
          },
          scales: {
            x: {
              type: 'category',
              labels: hours,
              offset: true,
              grid: {
                display: false
              }
            },
            y: {
              type: 'category',
              labels: days,
              offset: true,
              grid: {
                display: false
              }
            }
          }
        }
      });
    }

    // Function to update engagement gauge
    function updateEngagementGauge(engagementRate) {
      const ctx = document.getElementById('engagement-gauge');
      if (!ctx) return;
      
      if (engagementGauge) {
        engagementGauge.destroy();
      }
      
      engagementGauge = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Engaged', 'Not Engaged'],
          datasets: [{
            data: [engagementRate, 100 - engagementRate],
            backgroundColor: ['#4CAF50', '#E0E0E0'],
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          cutout: '80%',
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              enabled: true,
              callbacks: {
                label: function(context) {
                  return `${context.label}: ${context.raw}%`;
                }
              }
            }
          }
        }
      });
    }

    // Function to update artwork votes chart
    function updateArtworkVotesChart(votesData) {
      console.log('Updating artwork votes chart with:', votesData);
      const ctx = document.getElementById("artwork-chart");
      if (!ctx) {
        console.error('Could not find artwork-chart element');
        return;
      }

      if (artworkChart) {
        artworkChart.destroy();
      }
      
      const labels = [
        'Measuring the Universe',
        'Think Far',
        'From Wind to Rivers to the Abyssal Plain',
        'Eleven Columns'
      ];
      
      // Ensure we have data for each artwork
      const data = labels.map(label => {
        const value = votesData[label] || 0;
        console.log(`Artwork: ${label}, Votes: ${value}`);
        return value;
      });
      
      console.log('Creating artwork chart with labels:', labels, 'and data:', data);
      
      artworkChart = new Chart(ctx, {
        type: "bar",
        data: {
          labels: labels,
          datasets: [{
            label: "Votes",
            tension: 0.4,
            borderWidth: 0,
            borderRadius: 4,
            borderSkipped: false,
            backgroundColor: "#43A047",
            data: data,
            maxBarThickness: 50
          }],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false,
            },
            title: {
              display: true,
              text: 'Most Popular Artworks'
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: {
                drawBorder: false,
                display: true,
                drawOnChartArea: true,
                drawTicks: false,
                borderDash: [5, 5]
              },
              ticks: {
                suggestedMin: 0,
                suggestedMax: 20,
                stepSize: 1,
                padding: 10,
                color: "#737373"
              },
            },
            x: {
              grid: {
                drawBorder: false,
                display: false,
                drawOnChartArea: false,
                drawTicks: false
              },
              ticks: {
                display: true,
                color: '#737373',
                padding: 10,
                font: {
                  size: 10
                },
                maxRotation: 45,
                minRotation: 45
              }
            },
          },
        },
      });
    }

    // Function to update emotion chart
    function updateEmotionChart(emotionData) {
      console.log('Updating emotion chart with:', emotionData);
      const ctx = document.getElementById("emotion-chart");
      if (!ctx) {
        console.error('Could not find emotion-chart element');
        return;
      }

      if (emotionChart) {
        emotionChart.destroy();
      }
      
      emotionChart = new Chart(ctx, {
        type: "line",
        data: {
          labels: Object.keys(emotionData),
          datasets: [{
            label: "Emotion Analysis",
            tension: 0.4,
            borderWidth: 2,
            pointRadius: 3,
            pointBackgroundColor: "#43A047",
            pointBorderColor: "transparent",
            borderColor: "#43A047",
            backgroundColor: "rgba(67, 160, 71, 0.1)",
            fill: true,
            data: Object.values(emotionData),
            maxBarThickness: 6
          }],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false,
            },
            title: {
              display: true,
              text: 'Visitor Emotions Analysis'
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: {
                drawBorder: false,
                display: true,
                drawOnChartArea: true,
                drawTicks: false,
                borderDash: [4, 4]
              },
              ticks: {
                suggestedMin: 0,
                suggestedMax: 50,
                stepSize: 5,
                display: true,
                padding: 10
              }
            },
            x: {
              grid: {
                drawBorder: false,
                display: false,
                drawOnChartArea: false,
                drawTicks: false
              },
              ticks: {
                display: true,
                padding: 10
              }
            },
          },
        },
      });
    }

    // Function to update recent responses
    function updateRecentResponses(responses) {
      console.log('Updating recent responses:', responses);
      const container = document.getElementById('recent-responses');
      if (!container) {
        console.error('Could not find recent-responses element');
        return;
      }
      
      container.innerHTML = ''; // Clear existing responses
      
      if (!responses || responses.length === 0) {
        container.innerHTML = '<li class="list-group-item border-0 d-flex justify-content-center ps-0 mb-2 border-radius-lg"><span class="text-sm">No responses yet</span></li>';
        return;
      }
      
      responses.slice(0, 10).forEach(response => {
        const li = document.createElement('li');
        li.className = 'list-group-item border-0 d-flex justify-content-between ps-0 mb-2 border-radius-lg';
        
        // Format the timestamp
        const timestamp = new Date(response.timestamp);
        const time = timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        const date = timestamp.toLocaleDateString();
        
        // Get emotion color
        const emotionColors = {
          'happy': 'text-success',
          'sad': 'text-danger',
          'nostalgic': 'text-info',
          'bored': 'text-warning'
        };
        const emotionColor = emotionColors[response.emotion] || 'text-dark';
        
        li.innerHTML = `
          <div class="d-flex flex-column">
            <h6 class="mb-1 text-dark font-weight-bold text-sm">${response.experience}</h6>
            <span class="text-xs">
              <i class="fas fa-palette me-1"></i> ${response.artwork} 
              <span class="mx-2">|</span>
              <i class="fas fa-heart me-1 ${emotionColor}"></i> ${response.emotion}
            </span>
          </div>
          <div class="d-flex align-items-center text-xs text-dark ms-2">
            <i class="far fa-clock me-1"></i>
            <span title="${date}">${time}</span>
          </div>
        `;
        
        container.appendChild(li);
      });
    }

    // Function to update charts with new data
    async function updateCharts() {
      console.log('Updating charts...');
      const data = await fetchData();
      console.log('Data for charts:', data);
      
      if (!data) {
        console.error('No data received');
        return;
      }
      
      // Update existing charts
      if (data.artworkVotes) {
        updateArtworkVotesChart(data.artworkVotes);
      }
      
      if (data.emotionCounts) {
        updateEmotionChart(data.emotionCounts);
      }

      // Update recent responses
      if (data.recentResponses) {
        updateRecentResponses(data.recentResponses);
      }

      // Update new charts
      const timeEmotionData = processTimeEmotionData(data.recentResponses);
      updateEmotionTimeChart(timeEmotionData);
      
      const artworkEmotionData = processArtworkEmotionData(data.recentResponses);
      updateArtworkEmotionChart(artworkEmotionData);
      
      updateTimeHeatmap(data.recentResponses);
      updateEngagementGauge(data.dailyStats?.engagementRate || 0);
    }

    // Function to process monthly entries data
    function processMonthlyData(responses) {
      // Create a map to store counts by month
      const monthlyData = new Map();
      
      // Initialize all months with 0
      const months = [
        'January', 'February', 'March', 'April', 
        'May', 'June', 'July', 'August',
        'September', 'October', 'November', 'December'
      ];
      months.forEach(month => monthlyData.set(month, 0));
      
      responses.forEach(response => {
        const date = new Date(response.timestamp);
        const monthName = months[date.getMonth()];
        monthlyData.set(monthName, (monthlyData.get(monthName) || 0) + 1);
      });
      
      // Convert to array format for Chart.js
      const data = months.map(month => ({
        month: month,
        count: monthlyData.get(month) || 0
      }));
      
      return data;
    }

    // Function to update monthly entries chart
    function updateMonthlyChart(monthlyData) {
      const ctx = document.getElementById('weekly-entries-chart').getContext('2d');
      
      // Destroy existing chart if it exists
      if (window.monthlyChart) {
        window.monthlyChart.destroy();
      }
      
      window.monthlyChart = new Chart(ctx, {
        type: 'line',
      data: {
          labels: monthlyData.map(d => d.month),
        datasets: [{
            label: 'Number of Responses',
            data: monthlyData.map(d => d.count),
            borderColor: '#4CAF50',
            backgroundColor: 'rgba(76, 175, 80, 0.1)',
            tension: 0.4,
          fill: true,
            pointBackgroundColor: '#4CAF50',
            pointRadius: 4,
            pointHoverRadius: 6
          }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
              display: true,
              position: 'top',
              labels: {
                color: '#344767'
              }
            },
            title: {
              display: true,
              text: 'Monthly Response Frequency',
              color: '#344767',
              font: {
                size: 16
              }
            }
        },
        scales: {
          y: {
              beginAtZero: true,
            grid: {
              drawBorder: false,
              display: true,
              drawOnChartArea: true,
              drawTicks: false,
                borderDash: [5, 5]
            },
            ticks: {
                stepSize: 1,
                color: '#344767',
              padding: 10,
                callback: function(value) {
                  return Math.floor(value);
                }
            }
          },
          x: {
            grid: {
              drawBorder: false,
                display: true,
                drawOnChartArea: true,
              drawTicks: false,
                borderDash: [5, 5]
            },
            ticks: {
                color: '#344767',
                padding: 10
              }
            }
          }
        }
      });
    }
  </script>
  <script>
    var win = navigator.platform.indexOf('Win') > -1;
    if (win && document.querySelector('#sidenav-scrollbar')) {
      var options = {
        damping: '0.5'
      }
      Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
    }
  </script>
  <!-- Github buttons -->
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="../assets/js/material-dashboard.min.js?v=3.2.0"></script>
</body>

</html>