<!--
=========================================================
* Material Dashboard 3 - v3.2.0
=========================================================

* Product Page: https://www.creative-tim.com/product/material-dashboard
* Copyright 2024 Creative Tim (https://www.creative-tim.com)
* Licensed under MIT (https://www.creative-tim.com/license)
* Coded by Creative Tim

=========================================================

* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
  <link rel="icon" type="image/png" href="../assets/img/favicon.png">
  <title>
    GGI
  </title>
  <!--     Fonts and icons     -->
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Inter:300,400,500,600,700,900" />
  <!-- Nucleo Icons -->
  <link href="../assets/css/nucleo-icons.css" rel="stylesheet" />
  <link href="../assets/css/nucleo-svg.css" rel="stylesheet" />
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <!-- Material Icons -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
  <!-- CSS Files -->
  <link id="pagestyle" href="../assets/css/material-dashboard.css?v=3.2.0" rel="stylesheet" />
</head>

<body class="g-sidenav-show  bg-gray-100">
  <aside class="sidenav navbar navbar-vertical navbar-expand-xs border-radius-lg fixed-start ms-2  bg-white my-2" id="sidenav-main">
    <div class="sidenav-header">
      <i class="fas fa-times p-3 cursor-pointer text-dark opacity-5 position-absolute end-0 top-0 d-none d-xl-none" aria-hidden="true" id="iconSidenav"></i>
      <a class="navbar-brand px-4 py-3 m-0" href="https://www.thegund.org/" target="_blank">
        <img src="../assets/img/gundgal.jpg" class="navbar-brand-img" width="26" height="26" alt="gund_logo">
        <span class="ms-1 text-sm text-dark">The Gund</span>
      </a>
    </div>
    <hr class="horizontal dark mt-0 mb-2">
    <div class="collapse navbar-collapse  w-auto " id="sidenav-collapse-main">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link active bg-gradient-dark text-white" href="../pages/dashboard.html">
            <i class="material-symbols-rounded opacity-5">dashboard</i>
            <span class="nav-link-text ms-1">Dashboard</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-dark" href="../pages/artists.html">
            <i class="material-symbols-rounded opacity-5">table_view</i>
            <span class="nav-link-text ms-1">Artists</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-dark" href="../pages/display.html">
            <i class="material-symbols-rounded opacity-5">tv</i>
            <span class="nav-link-text ms-1">Display</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-dark" href="../pages/virtual-reality.html">
            <i class="material-symbols-rounded opacity-5">view_in_ar</i>
            <span class="nav-link-text ms-1">Virtual Reality</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-dark" href="../pages/notifications.html">
            <i class="material-symbols-rounded opacity-5">notifications</i>
            <span class="nav-link-text ms-1">Notifications</span>
          </a>
        </li>
        <li class="nav-item mt-3">
          <h6 class="ps-4 ms-2 text-uppercase text-xs text-dark font-weight-bolder opacity-5">Account pages</h6>
        </li>
        <li class="nav-item">
          <a class="nav-link text-dark" href="../pages/profile.html">
            <i class="material-symbols-rounded opacity-5">person</i>
            <span class="nav-link-text ms-1">Profile</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-dark" href="../pages/sign-in.html">
            <i class="material-symbols-rounded opacity-5">login</i>
            <span class="nav-link-text ms-1">Sign In</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-dark" href="../pages/sign-up.html">
            <i class="material-symbols-rounded opacity-5">assignment</i>
            <span class="nav-link-text ms-1">Sign Up</span>
          </a>
        </li>
      </ul>
    </div>
    <div class="sidenav-footer position-absolute w-100 bottom-0 ">
      <div class="mx-3">
        <a class="btn btn-outline-dark mt-4 w-100" href="https://www.creative-tim.com/learning-lab/bootstrap/overview/material-dashboard?ref=sidebarfree" type="button">Documentation</a>
        <a class="btn bg-gradient-dark w-100" href="https://www.creative-tim.com/product/material-dashboard-pro?ref=sidebarfree" type="button">Upgrade to pro</a>
      </div>
    </div>
  </aside>
  <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg">
    <!-- Navbar -->
    <nav class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl" id="navbarBlur" navbar-scroll="true">
      <div class="container-fluid py-1 px-3">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0 me-sm-6 me-5">
            <li class="breadcrumb-item text-sm"><a class="opacity-5 text-dark" href="javascript:;">Pages</a></li>
            <li class="breadcrumb-item text-sm text-dark active" aria-current="page">Dashboard</li>
          </ol>
          <h6 class="font-weight-bolder mb-0">Dashboard</h6>
        </nav>
        <div class="collapse navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4" id="navbar">
          <div class="ms-md-auto pe-md-3 d-flex align-items-center">
            <div class="input-group input-group-outline">
              <label class="form-label">Type here...</label>
              <input type="text" class="form-control">
            </div>
          </div>
          <ul class="navbar-nav justify-content-end">
            <li class="nav-item d-flex align-items-center">
              <a href="javascript:;" class="nav-link text-body font-weight-bold px-0">
                <i class="fa fa-user me-sm-1"></i>
                <span class="d-sm-inline d-none">Sign In</span>
              </a>
            </li>
            <li class="nav-item d-xl-none ps-3 d-flex align-items-center">
              <a href="javascript:;" class="nav-link text-body p-0" id="iconNavbarSidenav">
                <div class="sidenav-toggler-inner">
                  <i class="sidenav-toggler-line"></i>
                  <i class="sidenav-toggler-line"></i>
                  <i class="sidenav-toggler-line"></i>
                    </div>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- End Navbar -->
    <div class="container-fluid py-4">
      <div class="row">
        <div class="col-lg-8">
      <div class="row">
            <div class="col-xl-12 mb-xl-0 mb-4">
              <div class="card bg-transparent shadow-xl">
                <div class="card-body p-3">
                <div class="chart">
                    <canvas id="artwork-chart" class="chart-canvas" height="300"></canvas>
                </div>
              </div>
              </div>
            </div>
            <div class="col-xl-12 mb-xl-0 mb-4">
              <div class="card bg-transparent shadow-xl">
                <div class="card-body p-3">
                <div class="chart">
                    <canvas id="emotion-chart" class="chart-canvas" height="300"></canvas>
                </div>
              </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-4">
          <div class="card h-100">
            <div class="card-header pb-0 p-3">
              <div class="row">
                <div class="col-6 d-flex align-items-center">
                  <h6 class="mb-0">Recent Responses</h6>
                </div>
                <div class="col-6 text-end">
                  <button class="btn btn-outline-primary btn-sm mb-0">View All</button>
              </div>
              </div>
            </div>
            <div class="card-body p-3 pb-0">
              <ul class="list-group" id="recent-responses">
                <!-- Recent responses will be added here dynamically -->
              </ul>
          </div>
        </div>
          <div class="card h-100 mt-4">
            <div class="card-header pb-0 p-3">
              <div class="row">
                <div class="col-6 d-flex align-items-center">
                  <h6 class="mb-0">Daily Statistics</h6>
                </div>
                <div class="col-6 text-end">
                  <span class="text-sm font-weight-bold">Today</span>
                  </div>
                </div>
              </div>
            <div class="card-body p-3">
              <div class="row">
                <div class="col-6">
                  <div class="card bg-gradient-dark shadow-xl">
                    <div class="card-body p-3">
                      <div class="row">
                        <div class="col-8">
                          <div class="numbers">
                            <p class="text-sm mb-0 text-capitalize font-weight-bold">Total Responses</p>
                            <h5 class="font-weight-bolder mb-0" id="total-responses">0</h5>
            </div>
                          </div>
                        <div class="col-4 text-end">
                          <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
                            <i class="material-symbols-rounded text-lg opacity-10" aria-hidden="true">people</i>
                          </div>
                        </div>
                        </div>
                            </div>
                          </div>
                          </div>
                <div class="col-6">
                  <div class="card bg-gradient-dark shadow-xl">
            <div class="card-body p-3">
                      <div class="row">
                        <div class="col-8">
                          <div class="numbers">
                            <p class="text-sm mb-0 text-capitalize font-weight-bold">Engagement Rate</p>
                            <h5 class="font-weight-bolder mb-0" id="engagement-rate">0%</h5>
                  </div>
                </div>
                        <div class="col-4 text-end">
                          <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
                            <i class="material-symbols-rounded text-lg opacity-10" aria-hidden="true">trending_up</i>
                  </div>
                </div>
                  </div>
                </div>
                  </div>
                </div>
                  </div>
                </div>
                  </div>
                </div>
              </div>
    </div>
    <div class="row mt-4">
      <div class="col-12">
        <div class="card">
          <div class="card-header p-3">
            <h5 class="mb-0">Weekly Response Frequency</h5>
          </div>
          <div class="card-body p-3">
            <div class="chart">
              <canvas id="weekly-entries-chart" class="chart-canvas" height="300"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
  <div class="fixed-plugin">
    <a class="fixed-plugin-button text-dark position-fixed px-3 py-2">
      <i class="material-symbols-rounded py-2">settings</i>
    </a>
    <div class="card shadow-lg">
      <div class="card-header pb-0 pt-3">
        <div class="float-start">
          <h5 class="mt-3 mb-0">Material UI Configurator</h5>
          <p>See our dashboard options.</p>
        </div>
        <div class="float-end mt-4">
          <button class="btn btn-link text-dark p-0 fixed-plugin-close-button">
            <i class="material-symbols-rounded">clear</i>
          </button>
        </div>
        <!-- End Toggle Button -->
      </div>
      <hr class="horizontal dark my-1">
      <div class="card-body pt-sm-3 pt-0">
        <!-- Sidebar Backgrounds -->
        <div>
          <h6 class="mb-0">Sidebar Colors</h6>
        </div>
        <a href="javascript:void(0)" class="switch-trigger background-color">
          <div class="badge-colors my-2 text-start">
            <span class="badge filter bg-gradient-primary" data-color="primary" onclick="sidebarColor(this)"></span>
            <span class="badge filter bg-gradient-dark active" data-color="dark" onclick="sidebarColor(this)"></span>
            <span class="badge filter bg-gradient-info" data-color="info" onclick="sidebarColor(this)"></span>
            <span class="badge filter bg-gradient-success" data-color="success" onclick="sidebarColor(this)"></span>
            <span class="badge filter bg-gradient-warning" data-color="warning" onclick="sidebarColor(this)"></span>
            <span class="badge filter bg-gradient-danger" data-color="danger" onclick="sidebarColor(this)"></span>
          </div>
        </a>
        <!-- Sidenav Type -->
        <div class="mt-3">
          <h6 class="mb-0">Sidenav Type</h6>
          <p class="text-sm">Choose between different sidenav types.</p>
        </div>
        <div class="d-flex">
          <button class="btn bg-gradient-dark px-3 mb-2" data-class="bg-gradient-dark" onclick="sidebarType(this)">Dark</button>
          <button class="btn bg-gradient-dark px-3 mb-2 ms-2" data-class="bg-transparent" onclick="sidebarType(this)">Transparent</button>
          <button class="btn bg-gradient-dark px-3 mb-2  active ms-2" data-class="bg-white" onclick="sidebarType(this)">White</button>
        </div>
        <p class="text-sm d-xl-none d-block mt-2">You can change the sidenav type just on desktop view.</p>
        <!-- Navbar Fixed -->
        <div class="mt-3 d-flex">
          <h6 class="mb-0">Navbar Fixed</h6>
          <div class="form-check form-switch ps-0 ms-auto my-auto">
            <input class="form-check-input mt-1 ms-auto" type="checkbox" id="navbarFixed" onclick="navbarFixed(this)">
          </div>
        </div>
        <hr class="horizontal dark my-3">
        <div class="mt-2 d-flex">
          <h6 class="mb-0">Light / Dark</h6>
          <div class="form-check form-switch ps-0 ms-auto my-auto">
            <input class="form-check-input mt-1 ms-auto" type="checkbox" id="dark-version" onclick="darkMode(this)">
          </div>
        </div>
        <hr class="horizontal dark my-sm-4">
        <a class="btn bg-gradient-info w-100" href="https://www.creative-tim.com/product/material-dashboard-pro">Free Download</a>
        <a class="btn btn-outline-dark w-100" href="https://www.creative-tim.com/learning-lab/bootstrap/overview/material-dashboard">View documentation</a>
        <div class="w-100 text-center">
          <a class="github-button" href="https://github.com/creativetimofficial/material-dashboard" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star creativetimofficial/material-dashboard on GitHub">Star</a>
          <h6 class="mt-3">Thank you for sharing!</h6>
          <a href="https://twitter.com/intent/tweet?text=Check%20Material%20UI%20Dashboard%20made%20by%20%40CreativeTim%20%23webdesign%20%23dashboard%20%23bootstrap5&amp;url=https%3A%2F%2Fwww.creative-tim.com%2Fproduct%2Fsoft-ui-dashboard" class="btn btn-dark mb-0 me-2" target="_blank">
            <i class="fab fa-twitter me-1" aria-hidden="true"></i> Tweet
          </a>
          <a href="https://www.facebook.com/sharer/sharer.php?u=https://www.creative-tim.com/product/material-dashboard" class="btn btn-dark mb-0 me-2" target="_blank">
            <i class="fab fa-facebook-square me-1" aria-hidden="true"></i> Share
          </a>
        </div>
      </div>
    </div>
  </div>
  <!--   Core JS Files   -->
  <script src="../assets/js/core/popper.min.js"></script>
  <script src="../assets/js/core/bootstrap.min.js"></script>
  <script src="../assets/js/plugins/perfect-scrollbar.min.js"></script>
  <script src="../assets/js/plugins/smooth-scrollbar.min.js"></script>
  <script src="../assets/js/plugins/chartjs.min.js"></script>
  <script>
    // Store chart instances
    let artworkChart = null;
    let emotionChart = null;

    // Function to fetch data from Google Sheets
    async function fetchData() {
      try {
        console.log('Fetching data from Google Sheets...');
        const spreadsheetId = '1HbaoSO3-QHKhYUHy4DuerkH_Z2kV9eoPQOOhTkTWwhQ';
        const apiKey = 'AIzaSyCOmA67laPyNblmRifkKckoYCZKo8FmyfU';
        const range = 'Form Responses 1!A:D';
        
        const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=${apiKey}`;
        
        const response = await fetch(url, {
          method: 'GET',
          headers: {
            'Accept': 'application/json'
          }
        });
        
        if (!response.ok) {
          throw new Error(`API request failed: ${response.status} ${response.statusText}`);
        }
        
        const data = await response.json();
        if (!data.values || data.values.length === 0) {
          throw new Error('No data found in sheet');
        }
        
        const processedData = processSheetData(data.values);
        
        // Process monthly data instead of weekly
        const monthlyData = processMonthlyData(processedData.recentResponses);
        updateMonthlyChart(monthlyData);
        
        return processedData;
      } catch (error) {
        console.error('Error fetching data:', error);
        return getSampleData();
      }
    }

    // Function to process sheet data
    function processSheetData(values) {
      if (!values || values.length === 0) {
        throw new Error('No data found in the sheet');
      }
      
      const headers = values[0];
      // Update column indices based on your actual Google Sheet headers
      const experienceColIndex = 1; // "How would you describe your experience..."
      const artworkColIndex = 2;    // "Which artwork stood out to you the most?"
      const timestampColIndex = 0;   // Timestamp column
      
      const artworkVotes = {
        'Tree': 0,
        'Flower': 0,
        'Swing': 0,
        'House': 0
      };
      
      const emotionCounts = {
        'happy': 0,
        'sad': 0,
        'nostalgic': 0,
        'bored': 0
      };
      
      const recentResponses = [];
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      let totalResponsesToday = 0;
      let totalEngagementToday = 0;
      
      // Process all rows (including those not from today for testing)
      for (let i = 1; i < values.length; i++) {
        const row = values[i];
        const timestamp = new Date(row[timestampColIndex]);
        const experience = row[experienceColIndex]?.trim() || '';
        const artwork = row[artworkColIndex]?.trim() || '';
        
        // Count all responses
        totalResponsesToday++;
        
        if (artwork && artworkVotes.hasOwnProperty(artwork)) {
          artworkVotes[artwork]++;
        }
        
        const emotion = classifyEmotion(experience);
        if (emotionCounts.hasOwnProperty(emotion)) {
          emotionCounts[emotion]++;
        }
        
        if (emotion === 'happy' || emotion === 'nostalgic') {
          totalEngagementToday++;
        }
        
        // Add to recent responses (keep the 10 most recent)
        recentResponses.push({
          experience: experience,
          artwork: artwork || 'Unknown',
          emotion: emotion,
          timestamp: row[timestampColIndex]
        });
      }
      
      // Sort responses by timestamp (most recent first) and take the first 10
      recentResponses.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      const recent10 = recentResponses.slice(0, 10);
      
      const engagementRate = totalResponsesToday > 0 ? 
        Math.round((totalEngagementToday / totalResponsesToday) * 100) : 0;
      
      console.log('Processed data:', {
        artworkVotes,
        emotionCounts,
        recentResponses: recent10,
        totalResponses: totalResponsesToday
      });
      
      return {
        artworkVotes,
        emotionCounts,
        recentResponses: recent10,
        dailyStats: {
          totalResponses: totalResponsesToday,
          engagementRate
        }
      };
    }

    // Function to classify emotion from text
    function classifyEmotion(text) {
      text = text.toLowerCase();
      
      const happyKeywords = ['happy', 'joy', 'great', 'wonderful', 'amazing', 'love', 'enjoy', 'beautiful', 'excellent', 'fantastic', 'inspiring', 'uplifting', 'delightful', 'peaceful', 'calm'];
      const sadKeywords = ['sad', 'disappoint', 'bad', 'poor', 'unhappy', 'terrible', 'awful', 'horrible', 'upset', 'depressed', 'uninspiring', 'disheartening', 'gloomy', 'melancholy'];
      const nostalgicKeywords = ['nostalgic', 'memory', 'remember', 'childhood', 'past', 'old', 'back then', 'reminisce', 'recall', 'memories', 'youth', 'childhood', 'reminiscent', 'sentimental', 'grandmother', 'grandfather', 'family'];
      const boredKeywords = ['bored', 'boring', 'uninteresting', 'dull', 'tired', 'monotonous', 'repetitive', 'tedious', 'uninspiring', 'unexciting', 'uninspired', 'unmotivated'];
      
      const counts = {
        'happy': 0,
        'sad': 0,
        'nostalgic': 0,
        'bored': 0
      };
      
      happyKeywords.forEach(keyword => { if (text.includes(keyword)) counts.happy++; });
      sadKeywords.forEach(keyword => { if (text.includes(keyword)) counts.sad++; });
      nostalgicKeywords.forEach(keyword => { if (text.includes(keyword)) counts.nostalgic++; });
      boredKeywords.forEach(keyword => { if (text.includes(keyword)) counts.bored++; });
      
      let maxCount = 0;
      let maxEmotion = 'happy';
      
      for (const emotion in counts) {
        if (counts[emotion] > maxCount) {
          maxCount = counts[emotion];
          maxEmotion = emotion;
        }
      }
      
      return maxEmotion;
    }

    // Wait for the DOM to be fully loaded before initializing charts
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM loaded, initializing dashboard...');
      
      // Initialize charts immediately
      updateCharts();
      fetchRecentResponses();
      
      // Update every 30 seconds
      setInterval(() => {
        updateCharts();
        fetchRecentResponses();
      }, 30000);
    });

    function getSampleData() {
      return {
        artworkVotes: {
          'Tree': 0,
          'Flower': 1,
          'Swing': 1,
          'House': 1
        },
        emotionCounts: {
          'happy': 1,
          'sad': 1,
          'nostalgic': 1,
          'bored': 0
        },
        recentResponses: [
          {
            experience: "Made me so happy!",
            artwork: "Flower",
            emotion: "happy",
            timestamp: "4/15/2025 13:17:52"
          },
          {
            experience: "Dissappointing",
            artwork: "Swing",
            emotion: "sad",
            timestamp: "4/15/2025 13:18:04"
          },
          {
            experience: "Reminded me of my grandmother",
            artwork: "House",
            emotion: "nostalgic",
            timestamp: "4/15/2025 13:18:17"
          }
        ],
        dailyStats: {
          totalResponses: 3,
          engagementRate: 75
        }
      };
    }

    // Function to update daily statistics
    function updateDailyStats(data) {
      const totalResponsesElement = document.getElementById('total-responses');
      const engagementRateElement = document.getElementById('engagement-rate');
      
      if (totalResponsesElement) {
        totalResponsesElement.textContent = data.dailyStats.totalResponses;
      }
      
      if (engagementRateElement) {
        engagementRateElement.textContent = `${data.dailyStats.engagementRate}%`;
      }
    }

    // Function to update charts with new data
    async function updateCharts() {
      console.log('Updating charts...');
      const data = await fetchData();
      console.log('Data for charts:', data);
      
      if (!data) {
        console.error('No data received');
        return;
      }
      
      // Update artwork votes chart
      if (data.artworkVotes) {
        updateArtworkVotesChart(data.artworkVotes);
      }
      
      // Update emotion analysis chart
      if (data.emotionCounts) {
        updateEmotionChart(data.emotionCounts);
      }

      // Update daily statistics
      if (data.dailyStats) {
        updateDailyStats(data);
      }

    }

    function updateArtworkVotesChart(votesData) {
      console.log('Updating artwork votes chart with:', votesData);
      const canvas = document.getElementById("artwork-chart");
      if (!canvas) {
        console.error('Could not find artwork-chart element');
        return;
      }

      // Destroy existing chart if it exists
      if (artworkChart) {
        artworkChart.destroy();
      }
      
      const ctx = canvas.getContext('2d');
      if (!ctx) {
        console.error('Could not get 2D context for artwork chart');
        return;
      }
      
      const labels = Object.keys(votesData);
      const data = Object.values(votesData);
      
      console.log('Creating artwork chart with labels:', labels, 'and data:', data);
      
      artworkChart = new Chart(ctx, {
      type: "bar",
      data: {
          labels: labels,
        datasets: [{
            label: "Votes",
          tension: 0.4,
          borderWidth: 0,
          borderRadius: 4,
          borderSkipped: false,
          backgroundColor: "#43A047",
            data: data,
          barThickness: 'flex'
          }],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false,
            },
            title: {
              display: true,
              text: 'Most Popular Artworks'
          }
        },
        scales: {
          y: {
              beginAtZero: true,
              min: 0,
              max: 50,
            grid: {
              drawBorder: false,
              display: true,
              drawOnChartArea: true,
              drawTicks: false,
              borderDash: [5, 5],
              color: '#e5e5e5'
            },
            ticks: {
              suggestedMin: 0,
                suggestedMax: 50,
                stepSize: 5,
              padding: 10,
              font: {
                size: 14,
                lineHeight: 2
              },
              color: "#737373"
            },
          },
          x: {
            grid: {
              drawBorder: false,
              display: false,
              drawOnChartArea: false,
              drawTicks: false,
              borderDash: [5, 5]
            },
            ticks: {
              display: true,
              color: '#737373',
              padding: 10,
              font: {
                size: 14,
                lineHeight: 2
              },
            }
          },
        },
      },
    });
    }

    function updateEmotionChart(emotionData) {
      console.log('Updating emotion chart with:', emotionData);
      const canvas = document.getElementById("emotion-chart");
      if (!canvas) {
        console.error('Could not find emotion-chart element');
        return;
      }

      // Destroy existing chart if it exists
      if (emotionChart) {
        emotionChart.destroy();
      }
      
      const ctx = canvas.getContext('2d');
      if (!ctx) {
        console.error('Could not get 2D context for emotion chart');
        return;
      }
      
      emotionChart = new Chart(ctx, {
        type: "bar",
      data: {
          labels: Object.keys(emotionData),
        datasets: [{
            label: "Emotion Analysis",
          tension: 0,
          borderWidth: 2,
          pointRadius: 3,
          pointBackgroundColor: "#43A047",
          pointBorderColor: "transparent",
          borderColor: "#43A047",
          backgroundColor: "transparent",
          fill: true,
            data: Object.values(emotionData),
          maxBarThickness: 6
        }],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false,
          },
            title: {
              display: true,
              text: 'Visitor Emotions Analysis'
            }
          },
        scales: {
          y: {
              beginAtZero: true,
              min: 0,
              max: 50,
            grid: {
              drawBorder: false,
              display: true,
              drawOnChartArea: true,
              drawTicks: false,
              borderDash: [4, 4],
              color: '#e5e5e5'
            },
            ticks: {
                suggestedMin: 0,
                suggestedMax: 50,
                stepSize: 5,
              display: true,
              color: '#737373',
              padding: 10,
              font: {
                size: 12,
                lineHeight: 2
              },
            }
          },
          x: {
            grid: {
              drawBorder: false,
              display: false,
              drawOnChartArea: false,
              drawTicks: false,
              borderDash: [5, 5]
            },
            ticks: {
              display: true,
              color: '#737373',
              padding: 10,
              font: {
                size: 12,
                lineHeight: 2
              },
            }
          },
        },
      },
    });
    }

    // Function to fetch and display recent responses
    async function fetchRecentResponses() {
      try {
        console.log('Fetching recent responses from Google Sheets...');
        const data = await fetchData(); // Reuse the existing fetchData function
        
        if (!data || !data.recentResponses) {
          console.warn('No recent responses found');
          return;
        }
        
        updateRecentResponses(data.recentResponses);
      } catch (error) {
        console.error('Error fetching recent responses:', error);
        // Fall back to sample data if there's an error
        updateRecentResponses(getSampleData().recentResponses);
      }
    }

    function updateRecentResponses(responses) {
      const container = document.getElementById('recent-responses');
      if (!container) {
        console.error('Could not find recent-responses element');
        return;
      }
      
      container.innerHTML = ''; // Clear existing responses
      
      if (responses.length === 0) {
        container.innerHTML = '<li class="list-group-item border-0 d-flex justify-content-center ps-0 mb-2 border-radius-lg"><span class="text-sm">No responses yet</span></li>';
        return;
      }
      
      responses.forEach(response => {
        const li = document.createElement('li');
        li.className = 'list-group-item border-0 d-flex justify-content-between ps-0 mb-2 border-radius-lg';
        
        // Format the timestamp
        const timestamp = new Date(response.timestamp);
        const time = timestamp.toLocaleTimeString();
        const date = timestamp.toLocaleDateString();
        
        // Get emotion color
        const emotionColors = {
          'happy': 'text-success',
          'sad': 'text-danger',
          'nostalgic': 'text-info',
          'bored': 'text-warning'
        };
        const emotionColor = emotionColors[response.emotion] || 'text-dark';
        
        li.innerHTML = `
          <div class="d-flex flex-column">
            <h6 class="mb-1 text-dark font-weight-bold text-sm">${response.experience}</h6>
            <span class="text-xs">
              <i class="fas fa-palette me-1"></i> ${response.artwork} 
              <span class="mx-2">|</span>
              <i class="fas fa-heart me-1 ${emotionColor}"></i> ${response.emotion}
            </span>
          </div>
          <div class="d-flex align-items-center text-xs text-dark ms-2">
            <i class="far fa-clock me-1"></i>
            <span title="${date}">${time}</span>
          </div>
        `;
        
        container.appendChild(li);
      });
      
      // Add View All button functionality
      const viewAllBtn = document.querySelector('.btn-outline-primary');
      if (viewAllBtn) {
        viewAllBtn.onclick = () => {
          // You can implement view all functionality here
          console.log('View all responses clicked');
        };
      }
    }

    // Function to process monthly entries data
    function processMonthlyData(responses) {
      // Create a map to store counts by month
      const monthlyData = new Map();
      
      // Initialize all months with 0
      const months = [
        'January', 'February', 'March', 'April', 
        'May', 'June', 'July', 'August',
        'September', 'October', 'November', 'December'
      ];
      months.forEach(month => monthlyData.set(month, 0));
      
      responses.forEach(response => {
        const date = new Date(response.timestamp);
        const monthName = months[date.getMonth()];
        monthlyData.set(monthName, (monthlyData.get(monthName) || 0) + 1);
      });
      
      // Convert to array format for Chart.js
      const data = months.map(month => ({
        month: month,
        count: monthlyData.get(month) || 0
      }));
      
      return data;
    }

    // Function to update monthly entries chart
    function updateMonthlyChart(monthlyData) {
      const ctx = document.getElementById('weekly-entries-chart').getContext('2d');
      
      // Destroy existing chart if it exists
      if (window.monthlyChart) {
        window.monthlyChart.destroy();
      }
      
      window.monthlyChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: monthlyData.map(d => d.month),
          datasets: [{
            label: 'Number of Responses',
            data: monthlyData.map(d => d.count),
            borderColor: '#4CAF50',
            backgroundColor: 'rgba(76, 175, 80, 0.1)',
            tension: 0.4,
            fill: true,
            pointBackgroundColor: '#4CAF50',
            pointRadius: 4,
            pointHoverRadius: 6
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: true,
              position: 'top',
              labels: {
                color: '#344767'
              }
            },
            title: {
              display: true,
              text: 'Monthly Response Frequency',
              color: '#344767',
              font: {
                size: 16
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: {
                drawBorder: false,
                display: true,
                drawOnChartArea: true,
                drawTicks: false,
                borderDash: [5, 5]
              },
              ticks: {
                stepSize: 1,
                color: '#344767',
                padding: 10,
                callback: function(value) {
                  return Math.floor(value);
                }
              }
            },
            x: {
              grid: {
                drawBorder: false,
                display: true,
                drawOnChartArea: true,
                drawTicks: false,
                borderDash: [5, 5]
              },
              ticks: {
                color: '#344767',
                padding: 10
              }
            }
          }
        }
      });
    }
  </script>
  <script>
    var win = navigator.platform.indexOf('Win') > -1;
    if (win && document.querySelector('#sidenav-scrollbar')) {
      var options = {
        damping: '0.5'
      }
      Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
    }
  </script>
  <!-- Github buttons -->
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="../assets/js/material-dashboard.min.js?v=3.2.0"></script>
</body>

</html>